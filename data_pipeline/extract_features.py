### class contains methods for extracting particular features from smali files
import re

def build_api_dict(file, global_dict):
    """Adds api calls and frequencies within a single file to global api dictionary and returns it
    
    :param file : str
        Content from one file
        
    :param global_dict : dict
        Global api dictionary to augment
    """
    codeblocks = file.split(".end method") 
    for codeblock in codeblocks:
        api_calls = re.findall('invoke-.+', codeblock) 
        for call in api_calls:
            content = call.split("}, ")
            if content[-1] not in global_dict:
                global_dict[content[-1]] = 1
            else:
                global_dict[content[-1]] += 1
    return global_dict


def build_invoke_method_dict(file, global_dict):
    """Adds invoke methods and frequencies within a single file to global invoke method dictionary and returns it
    
    :param file : str
        Content from one file
        
    :param global_dict : dict
        Global api dictionary to augment
    """
    codeblocks = file.split(".end method") 
    for codeblock in codeblocks:
        api_calls = re.findall('invoke-.+', codeblock) 
        for call in api_calls:
            method = re.findall('(?<=\-)(.+?)(?=\{)', call)[0].strip()
            if method not in global_dict.keys():
                global_dict[method] = 1
            else:
                global_dict[method] += 1
    return global_dict