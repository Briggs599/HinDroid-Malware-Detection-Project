import os
import re
import numpy as np
import pandas as pd
import pickle
import json

#ToDO all:
# get pipeline working
# create more stable data extraction
# add comments
# move all magic number and params to data-params.json

mal_fp = "/teams/DSC180A_FA20_A00/a04malware/malware"
benign_fp = "/teams/DSC180A_FA20_A00/a04malware/popular-apps"


#import customs
from data_pipeline.model_file.model import *
from data_pipeline.get_data import *
from data_pipeline.unpack import *
from data_pipeline.extract_features import *

print("main.py Starting")

mal_app_names = [name for name in os.listdir(mal_fp) if os.path.isdir(mal_fp + "/" + name)] 
benign_app_names = [name for name in os.listdir(benign_fp) if os.path.isdir(benign_fp + "/" + name)]

# df for malware apps
s_malware = time.time()
malware_df = create_feature_frame(mal_fp, mal_app_names)
print("Malware Dataframe Created " + str(int(time.time() - s_malware)))

# df for benign apps
s_benign = time.time()
benign_df = create_feature_frame(benign_fp, benign_app_names)
print("Benign Dataframe Created " + str(int(time.time() - s_malware)))

training_df = benign_df.join(malware_df, how='outer').T.fillna(0)
training_df['label'] = np.zeros(benign_df.shape[1]).append(np.ones(malware_df.shape[1])) 
pd.to_csv("training_data", training_df) #save progress
log_model(training_df)
